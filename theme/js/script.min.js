(()=>{document.addEventListener("DOMContentLoaded",function(){if(document.getElementById("category_id")){let t=function(o){let e=s=>Array.from(document.querySelectorAll(`input[name="${s}"]:checked`)).map(f=>f.value),r=e("duration"),c=e("price"),u=10,i=e("grade"),d=new URLSearchParams({grade:JSON.stringify(i),price:JSON.stringify(c),duration:JSON.stringify(r),page:o,posts_per_page:u,category_id:n});fetch("/wp-json/my_namespace/v1/filter-posts/?"+d.toString()).then(s=>{if(!s.ok)throw new Error("Failed to fetch the template.");return s.text()}).then(s=>{document.getElementById("posts-container").innerHTML=s;let f=document.getElementById("posts-container").querySelectorAll(".wish-btn");if(p){let l=g("product");try{l=l?JSON.parse(l):[]}catch(m){console.error("Error parsing cookies:",m),l=[]}f.forEach(m=>{let E=m.getAttribute("data-wp-id");l.includes(E)&&m.classList.add("active")})}}).catch(s=>console.error("Error loading posts:",s))};var L=t;let n=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){t(1)}),document.getElementById("pagination").addEventListener("click",function(o){if(o.target.classList.contains("pagination-link")){let e=parseInt(o.target.dataset.page);t(e)}})}let p=document.querySelectorAll(".wish-btn");if(p){let n=g("product");try{n=n?JSON.parse(n):[]}catch(t){console.error("Error parsing cookies:",t),n=[]}p.forEach(t=>{let o=t.getAttribute("data-wp-id");n.includes(o)&&t.classList.add("active")})}let h=document.getElementById("posts-container");h&&h.addEventListener("click",n=>{let t=n.target.closest(".wish-btn");if(!t)return;let o=g("product");try{o=o?JSON.parse(o):[]}catch(r){console.error("Error parsing cookies:",r),o=[]}let e=t.getAttribute("data-wp-id");o.includes(e)?(o=o.filter(r=>r!==e),t.classList.remove("active")):(o.push(e),t.classList.add("active")),v("product",JSON.stringify(o),7)});function g(n){let t=document.cookie.split(";");for(let o=0;o<t.length;o++){let e=t[o].trim();if(e.startsWith(n+"="))return e.substring(n.length+1)}return null}function v(n,t,o){let e=new Date;e.setTime(e.getTime()+o*24*60*60*1e3);let r="expires="+e.toUTCString();document.cookie=n+"="+t+";"+r+";path=/"}let a=[];function S(){let n=document.querySelector("#preview"),t=document.querySelector("input[type=file]").files;function o(e){if(/\.(jpe?g|png|gif)$/i.test(e.name)){let r=new FileReader;e.size>5242880?alert("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 5\u041C\u0431"):(r.addEventListener("load",function(){let c=new Image,u=document.createElement("div");u.textContent=e.name,c.height=100,c.title=e.name,c.src=this.result,a.push(e);let i=document.createElement("div"),d=document.createElement("div");d.className="delete",d.textContent="X",i.className="fileprew",i.appendChild(d),i.appendChild(u),n.appendChild(i),console.log("Files to upload:",a.length),console.log("File name:",e.name),console.log("File size:",e.size)},!1),r.readAsDataURL(e))}}t&&Array.from(t).forEach(o)}document.body.addEventListener("click",function(n){if(n.target.classList.contains("delete")){let t=Array.from(document.querySelectorAll(".delete")).indexOf(n.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",t),a.splice(t,1),n.target.parentElement.remove(),console.log("Files to upload:",a.length)}});let y=document.querySelector(".reviews_form");y&&y.addEventListener("submit",function(n){n.preventDefault();let t=n.target,o=t.querySelector("[name=name]").value,e=new FormData(t);if(a.forEach((r,c)=>{e.append(`file[${c}]`,r)}),!o){document.querySelector(".name_field input").classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"});return}fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:e}).then(r=>r.ok?r.json():r.json().then(c=>{throw new Error(c.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(r=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",r)}).catch(r=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",r),alert(r.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})});})();
