(()=>{document.addEventListener("DOMContentLoaded",function(){let y=document.getElementById("menu-toggle"),f=document.getElementById("mobile-menu");y&&f&&(y.addEventListener("click",e=>{e.stopPropagation(),y.classList.contains("is-active")?(f.classList.remove("-translate-x-[1700px]"),f.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),y.classList.toggle("is-active")}),document.addEventListener("click",e=>{!f.contains(e.target)&&!y.contains(e.target)&&(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]"),y.classList.add("is-active"),document.body.style.overflow="")}));let h=document.getElementById("sidebar-toggle"),m=document.getElementById("sidebar-menu");h&&m&&(h.addEventListener("click",e=>{e.stopPropagation(),h.classList.contains("is-active")?(m.classList.remove("-translate-x-[1700px]"),m.classList.add("translate-x-0")):(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]")),h.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(e=>{e.addEventListener("click",()=>{h.classList.toggle("is-active"),m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",e=>{!m.contains(e.target)&&!h.contains(e.target)&&(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]"),h.classList.add("is-active"))}));let b=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});b.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),b.init();let w=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});w.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),w.init();let _=new Swiper(".swiper",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});w.on("init",()=>{document.querySelector(".swiper-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".swiper-button-next").classList.remove("swiper-button-disabled")});let v=null,F=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,t){v={dates:e,range:t}}}),L=document.getElementById("okBtn"),E=document.getElementById("cancelBtn");L&&E&&(L.addEventListener("click",function(){v&&v.dates.length?(document.querySelector('input[name="dateForm"]').value=v.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),E.addEventListener("click",function(){v=null,F.clear(),B(),I(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let t=window.location.origin+window.location.pathname;e.href=t.toString()})}));function S(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let t=e.querySelector(".calendar"),n=e.getAttribute("data-dates"),r=n?JSON.parse(n):[],a=flatpickr(t,{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:r,onChange:function(c,i){console.log("Selected range:",{dates:c,range:i})}})})}if(S(),document.addEventListener("click",function(e){let t=e.target.closest(".dropdown-button");if(t){let a=document.querySelectorAll(".dropdown-button"),c=document.querySelectorAll(".dropdown-menu"),i=Array.from(a).indexOf(t),u=c[i];if(!u)return;let o=u.classList.contains("hidden"),s=t.getAttribute("data-close-on-click")==="true";c.forEach((d,g)=>{g!==i&&(d.classList.add("hidden"),a[g].setAttribute("aria-expanded","false"))}),o?(u.classList.remove("hidden"),t.setAttribute("aria-expanded","true")):(u.classList.add("hidden"),t.setAttribute("aria-expanded","false"))}let n=e.target.closest(".dropdown-menu .item");if(n){let a=n.closest(".dropdown-menu"),c=document.querySelector('.dropdown-button[aria-expanded="true"]');a&&c&&(a.classList.add("hidden"),c.setAttribute("aria-expanded","false"))}let r=e.target.closest(".dropdown-menu .close-menu");if(r){let a=r.closest(".dropdown-menu"),c=document.querySelector('.dropdown-button[aria-expanded="true"]');a&&c&&(a.classList.add("hidden"),c.setAttribute("aria-expanded","false"))}}),document.getElementById("category_id")){let t=function(){let n=s=>Array.from(document.querySelectorAll(`#filter-form input[name="${s}"]:checked, #sort_form input[name="${s}"]:checked`)).map(d=>d.value),r=n("duration"),a=n("price"),c=-1,i=n("grade_sort"),u=document.querySelector('input[name="dateForm"]').value??null,o=new URLSearchParams({grade_sort:JSON.stringify(i),price:JSON.stringify(a),duration:JSON.stringify(r),dateForm:u,posts_per_page:c,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(s=>{let d=new URL(s.href);u&&d.searchParams.set("dateForm",u),a&&d.searchParams.set("price",JSON.stringify(a)),r&&d.searchParams.set("duration",JSON.stringify(r)),s.href=d.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+o.toString()).then(s=>{if(!s.ok)throw new Error("Failed to fetch the template.");return s.text()}).then(s=>{document.getElementById("tours").innerHTML=s,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),S()}).catch(s=>console.error("Error loading posts:",s))};var N=t;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){t()}),document.getElementById("sort_form").addEventListener("change",function(){t()})}function B(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(t=>{switch(t.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":t.value="";break;case"checkbox":case"radio":t.checked=!1;break;case"select-one":case"select-multiple":t.selectedIndex=-1;break;default:break}})}function I(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}let x=document.querySelector(".reviews_form");if(x){let r=function(){n.forEach(o=>{o.style.display="block"}),t.classList.remove("hidden")},a=function(){let o=e.value.toLowerCase();if(o===""){t.classList.add("hidden");return}let s=!1;n.forEach(d=>{d.textContent.toLowerCase().includes(o)?(d.style.display="block",s=!0):d.style.display="none"}),s?t.classList.remove("hidden"):t.classList.add("hidden")},i=function(){let o=document.querySelector("#preview"),s=document.querySelector("input[type=file]").files;s&&Array.from(s).forEach(u)},u=function(o){if(/\.(jpe?g|png|gif)$/i.test(o.name)){let s=new FileReader;o.size>5242880?alert("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 5\u041C\u0431"):(s.addEventListener("load",function(){let d=new Image,g=document.createElement("div");g.textContent=o.name,d.height=100,d.title=o.name,d.src=this.result,c.push(o);let l=document.createElement("div"),p=document.createElement("div");p.className="delete font-bold cursor-pointer",p.textContent="X",l.className="fileprew flex gap-2 text-[#FF7A45] text-[14px] mb-2 items-center mt-4",l.appendChild(p),l.appendChild(g),preview.appendChild(l),console.log("Files to upload:",c.length),console.log("File name:",o.name),console.log("File size:",o.size)},!1),s.readAsDataURL(o))}};var T=r,V=a,J=i,M=u;let e=document.getElementById("inputField"),t=document.getElementById("suggestions"),n=Array.from(document.querySelectorAll(".data-item"));e.addEventListener("focus",r),e.addEventListener("input",a),n.forEach(o=>{o.addEventListener("click",()=>{e.value=o.textContent,t.classList.add("hidden")})}),document.body.addEventListener("click",function(o){if(!o.target.closest("#inputField")&&!o.target.closest("#suggestions")&&t.classList.add("hidden"),o.target.classList.contains("delete")){let s=Array.from(document.querySelectorAll(".delete")).indexOf(o.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",s),c.splice(s,1),o.target.parentElement.remove(),console.log("Files to upload:",c.length)}});let c=[];document.getElementById("popup-input-file").addEventListener("change",function(){i()}),x.addEventListener("submit",function(o){o.preventDefault();let s=o.target,d=s.querySelector("[name=name]").value,g=new FormData(s);if(c.forEach((l,p)=>{g.append(`file[${p}]`,l)}),!d){document.querySelector(".name_field input").classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"});return}fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:g}).then(l=>l.ok?l.json():l.json().then(p=>{throw new Error(p.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(l=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",l);let p=document.querySelector('.popup[data-popup="popup-success-rev"]');p&&p.classList.remove("hidden")}).catch(l=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",l),alert(l.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(t){t.preventDefault();let n=t.target,r=n.getAttribute("data-api"),a=new FormData(n),c=n.querySelector('input[name="tel"]');if(c){let i=a.get("tel");if(isValidPhone(i))isValidPhone(i)&&c.classList.remove("border","border-[#FF7A45]");else return c.classList.add("border","border-[#FF7A45]"),!1}r&&fetch(`/wp-json/custom/v1/${r}`,{method:"POST",headers:{},body:a}).then(i=>i.ok?i.json():i.json().then(u=>{throw new Error(u.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(i=>{if(!i.success)throw new Error(i.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return n.reset(),C(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(i=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",i),alert(i.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let t=e.getAttribute("data-open"),n=document.querySelector(`.popup[data-popup="${t}"]`);n&&n.classList.remove("hidden")})});function O(e){e.classList.remove("hidden")}function C(){document.querySelectorAll(".popup-close").forEach(e=>{let t=e.closest(".popup");t&&t.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let t=e.closest(".popup");t&&t.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(t){if(t.target===e){e.classList.add("hidden");let n=e.querySelector(".popup-media-container");n&&(n.innerHTML="")}})});let k=document.querySelectorAll(".wish-btn");if(k){let e=A("product");try{e=e?JSON.parse(e):[]}catch(t){console.error("Error parsing cookies:",t),e=[]}k.forEach(t=>{let n=t.getAttribute("data-wp-id");e.includes(n)&&t.classList.add("active")})}let q=document.getElementById("response");q&&q.addEventListener("click",e=>{let t=e.target.closest(".wish-btn");if(!t)return;let n=A("product");try{n=n?JSON.parse(n):[]}catch(a){console.error("Error parsing cookies:",a),n=[]}let r=t.getAttribute("data-wp-id");n.includes(r)?(n=n.filter(a=>a!==r),t.classList.remove("active")):(n.push(r),t.classList.add("active")),P("product",JSON.stringify(n),7)});function A(e){let t=document.cookie.split(";");for(let n=0;n<t.length;n++){let r=t[n].trim();if(r.startsWith(e+"="))return r.substring(e.length+1)}return null}function P(e,t,n){let r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);let a="expires="+r.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let t=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",t),filestoupload.splice(t,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}})});})();
