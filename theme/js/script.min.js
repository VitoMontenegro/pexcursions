(()=>{document.addEventListener("DOMContentLoaded",()=>{let p=document.getElementById("sidebar-menu"),m=window.scrollY;p&&window.addEventListener("scroll",()=>{window.scrollY>m?(p.classList.remove("lg:top-[40px]"),p.classList.add("lg:top-[-400px]")):(p.classList.remove("lg:top-[-400px]"),p.classList.add("lg:top-[40px]")),m=window.scrollY})});document.addEventListener("DOMContentLoaded",function(){let p=document.getElementById("menu-toggle"),m=document.getElementById("mobile-menu");p&&m&&(p.addEventListener("click",e=>{e.stopPropagation(),p.classList.contains("is-active")?(m.classList.remove("-translate-x-[1700px]"),m.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),p.classList.toggle("is-active")}),document.addEventListener("click",e=>{!m.contains(e.target)&&!p.contains(e.target)&&(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]"),p.classList.add("is-active"),document.body.style.overflow="")}));let h=document.getElementById("sidebar-toggle"),f=document.getElementById("sidebar-menu");h&&f&&(h.addEventListener("click",e=>{e.stopPropagation(),h.classList.contains("is-active")?(f.classList.remove("-translate-x-[1700px]"),f.classList.add("translate-x-0")):(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")),h.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(e=>{e.addEventListener("click",()=>{h.classList.toggle("is-active"),f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",e=>{!f.contains(e.target)&&!h.contains(e.target)&&(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]"),h.classList.add("is-active"))}));let b=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});b.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),b.init();let _=new Swiper(".swiper_similar",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});b.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),b.init();let v=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});v.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),v.init();let C=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});if(document.querySelectorAll(".swiper_tour").length){let e=new Swiper(".mySwiper",{spaceBetween:8,slidesPerView:3,freeMode:!0,watchSlidesProgress:!0,breakpoints:{640:{spaceBetween:20,slidesPerView:3}}}),t=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},thumbs:{swiper:e}});document.querySelectorAll(".mySwiper2 .swiper-slide img").forEach(o=>{let i=o.getAttribute("src"),n=o.getAttribute("alt"),r=o.getAttribute("data-video-id"),l=o.getAttribute("data-video-type");if(!r)o.setAttribute("data-fancybox","gallery"),o.setAttribute("data-src",i),o.setAttribute("data-caption",n);else{let s="";l==="youtube"?s=`https://www.youtube.com/embed/${r}?autoplay=1`:l==="rutube"?s=`https://rutube.ru/play/embed/${r}?autoplay=1`:l==="dzen"&&(s=r),o.setAttribute("data-fancybox","gallery"),o.setAttribute("data-src",s),o.setAttribute("data-caption",n)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(o,i,n){return n.alt}})}if(document.querySelectorAll(".swiper_block")){let e=new Swiper(".swiperBlock",{slidesPerView:1,spaceBetween:16,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2,spaceBetween:16},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}let y=null,E=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,t){y={dates:e,range:t}}}),L=document.getElementById("okBtn"),S=document.getElementById("cancelBtn");L&&S&&(L.addEventListener("click",function(){y&&y.dates.length?(document.querySelector('input[name="dateForm"]').value=y.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),S.addEventListener("click",function(){y=null,E.clear(),k(),A(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let t=window.location.origin+window.location.pathname;e.href=t.toString()})}));function x(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let t=e.querySelector(".calendar"),a=e.getAttribute("data-dates"),o=a?JSON.parse(a):[],i=flatpickr(t,{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:o,disable:[function(n){let r=o.some(s=>n.toISOString().split("T")[0]===s),l=n>=new Date;return!r&&!l}],onChange:function(){i.setDate(o,!1)}})})}if(x(),document.addEventListener("click",function(e){e.target.id==="cancelBtnFilter"&&(y=null,E.clear(),k(),A(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(a=>{let o=window.location.origin+window.location.pathname;a.href=o.toString()}))}),document.addEventListener("click",function(e){let t=e.target.closest(".dropdown-button");if(t){let i=document.querySelectorAll(".dropdown-button"),n=document.querySelectorAll(".dropdown-menu"),r=Array.from(i).indexOf(t),l=n[r];if(!l)return;let s=l.classList.contains("hidden"),c=t.getAttribute("data-close-on-click")==="true";n.forEach((d,w)=>{w!==r&&(d.classList.add("hidden"),i[w].setAttribute("aria-expanded","false"))}),s?(l.classList.remove("hidden"),t.setAttribute("aria-expanded","true")):(l.classList.add("hidden"),t.setAttribute("aria-expanded","false"))}let a=e.target.closest(".dropdown-menu .item");if(a){let i=a.closest(".dropdown-menu"),n=document.querySelector('.dropdown-button[aria-expanded="true"]');i&&n&&(i.classList.add("hidden"),n.setAttribute("aria-expanded","false"))}let o=e.target.closest(".dropdown-menu .close-menu");if(o){let i=o.closest(".dropdown-menu"),n=document.querySelector('.dropdown-button[aria-expanded="true"]');i&&n&&(i.classList.add("hidden"),n.setAttribute("aria-expanded","false"))}}),document.getElementById("category_id")){let t=function(){let a=c=>Array.from(document.querySelectorAll(`#filter-form input[name="${c}"]:checked, #sort_form input[name="${c}"]:checked`)).map(d=>d.value),o=a("duration"),i=a("price"),n=-1,r=a("grade_sort"),l=document.querySelector('input[name="dateForm"]').value??null,s=new URLSearchParams({grade_sort:JSON.stringify(r),price:JSON.stringify(i),duration:JSON.stringify(o),dateForm:l,posts_per_page:n,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(c=>{let d=new URL(c.href);l&&d.searchParams.set("dateForm",l),i&&d.searchParams.set("price",JSON.stringify(i)),o&&d.searchParams.set("duration",JSON.stringify(o)),c.href=d.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+s.toString()).then(c=>{if(!c.ok)throw new Error("Failed to fetch the template.");return c.json()}).then(c=>{console.log(c.data),document.getElementById("tours").innerHTML=c.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),x(),B()}).catch(c=>console.error("Error loading posts:",c))};var N=t;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){t()}),document.getElementById("sort_form").addEventListener("change",function(){t()})}function k(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(t=>{switch(t.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":t.value="";break;case"checkbox":case"radio":t.checked=!1;break;case"select-one":case"select-multiple":t.selectedIndex=-1;break;default:break}})}function A(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}let q=document.querySelector(".reviews_form");if(q){let o=function(){a.forEach(s=>{s.style.display="block"}),t.classList.remove("hidden")},i=function(){let s=e.value.toLowerCase();if(s===""){t.classList.add("hidden");return}let c=!1;a.forEach(d=>{d.textContent.toLowerCase().includes(s)?(d.style.display="block",c=!0):d.style.display="none"}),c?t.classList.remove("hidden"):t.classList.add("hidden")},r=function(){let s=document.querySelector("#preview"),c=document.querySelector("input[type=file]").files;c&&Array.from(c).forEach(l)},l=function(s){if(/\.(jpe?g|png|gif)$/i.test(s.name)){let c=new FileReader;s.size>5242880?alert("\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 5\u041C\u0431"):(c.addEventListener("load",function(){let d=new Image,w=document.createElement("div");w.textContent=s.name,d.height=100,d.title=s.name,d.src=this.result,n.push(s);let u=document.createElement("div"),g=document.createElement("div");g.className="delete font-bold cursor-pointer",g.textContent="X",u.className="fileprew flex gap-2 text-[#FF7A45] text-[14px] mb-2 items-center mt-4",u.appendChild(g),u.appendChild(w),preview.appendChild(u),console.log("Files to upload:",n.length),console.log("File name:",s.name),console.log("File size:",s.size)},!1),c.readAsDataURL(s))}};var M=o,j=i,J=r,$=l;let e=document.getElementById("inputField"),t=document.getElementById("suggestions"),a=Array.from(document.querySelectorAll(".data-item"));e.addEventListener("focus",o),e.addEventListener("input",i),a.forEach(s=>{s.addEventListener("click",()=>{e.value=s.textContent,t.classList.add("hidden")})}),document.body.addEventListener("click",function(s){if(!s.target.closest("#inputField")&&!s.target.closest("#suggestions")&&t.classList.add("hidden"),s.target.classList.contains("delete")){let c=Array.from(document.querySelectorAll(".delete")).indexOf(s.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",c),n.splice(c,1),s.target.parentElement.remove(),console.log("Files to upload:",n.length)}});let n=[];document.getElementById("popup-input-file").addEventListener("change",function(){r()}),q.addEventListener("submit",function(s){s.preventDefault();let c=s.target,d=c.querySelector("[name=name]").value,w=new FormData(c);if(n.forEach((u,g)=>{w.append(`file[${g}]`,u)}),!d){document.querySelector(".name_field input").classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"});return}fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:w}).then(u=>u.ok?u.json():u.json().then(g=>{throw new Error(g.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(u=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",u);let g=document.querySelector('.popup[data-popup="popup-success-rev"]');g&&g.classList.remove("hidden")}).catch(u=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",u),alert(u.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(t){t.preventDefault();let a=t.target,o=a.getAttribute("data-api"),i=new FormData(a),n=a.querySelector('input[name="tel"]');if(n){let r=i.get("tel");if(isValidPhone(r))isValidPhone(r)&&n.classList.remove("border","border-[#FF7A45]");else return n.classList.add("border","border-[#FF7A45]"),!1}o&&fetch(`/wp-json/custom/v1/${o}`,{method:"POST",headers:{},body:i}).then(r=>r.ok?r.json():r.json().then(l=>{throw new Error(l.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(r=>{if(!r.success)throw new Error(r.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return a.reset(),I(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(r=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",r),alert(r.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let t=e.getAttribute("data-open"),a=document.querySelector(`.popup[data-popup="${t}"]`);a&&a.classList.remove("hidden")})});function T(e){e.classList.remove("hidden")}function I(){document.querySelectorAll(".popup-close").forEach(e=>{let t=e.closest(".popup");t&&t.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let t=e.closest(".popup");t&&t.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(t){if(t.target===e){e.classList.add("hidden");let a=e.querySelector(".popup-media-container");a&&(a.innerHTML="")}})});function B(){let e=document.getElementById("response");if(!e)return;let t=e.querySelectorAll(".wish-btn");if(a(t),e.dataset.initialized)return;e.dataset.initialized=!0,e.addEventListener("click",i=>{let n=i.target.closest(".wish-btn");n&&o(n)});function a(i){let n=F("product");try{n=n?JSON.parse(n):[]}catch(r){console.error("Error parsing cookies:",r),n=[]}i.forEach(r=>{let l=r.getAttribute("data-wp-id");n.includes(l)&&r.classList.add("active")})}function o(i){let n=F("product");try{n=n?JSON.parse(n):[]}catch(l){console.error("Error parsing cookies:",l),n=[]}let r=i.getAttribute("data-wp-id");n.includes(r)?(n=n.filter(l=>l!==r),i.classList.remove("active")):(n.push(r),i.classList.add("active")),P("product",JSON.stringify(n),7),updateProductCount("product","#product-count span","#product-count div")}}B();function F(e){let t=document.cookie.split(";");for(let a=0;a<t.length;a++){let o=t[a].trim();if(o.startsWith(e+"="))return o.substring(e.length+1)}return null}function P(e,t,a){let o=new Date;o.setTime(o.getTime()+a*24*60*60*1e3);let i="expires="+o.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let t=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",t),filestoupload.splice(t,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}})});})();
